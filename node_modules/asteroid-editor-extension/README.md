# asteroid-editor-extension
v0.0.1

## About

An `AsteroidEditorExtension` is an Express sub-app used by the Asteroid Editor to plug in custom user interfaces at runtime. `AsteroidEditorExtension` is a base class for `AsteroidEditorGenerator` and `AsteroidSubEditor`.

## Options

### layout

The layout (relative to the global `/views` directory) that views rendered with `req.rendered` will be inserted into.

## Members

### app

A micro Asteroid app (behaves like an express app) which implements the custom UI.

### handle(url, rootUrl, req, res, next)

Called by the editor internally to route requests to `extension.app`. The relative `url` property will temporarily override `req.url` while `extension.app` handles the request.

## Building interfaces

The extension's `app` is automatically configured with the [ejs-locals](https://github.com/RandomEtc/ejs-locals) rendering engine for `*.ejs` files in the `/views` directory, relative to the module's `config.json` file.

The `app` is also automatically configured to serve static assets in the `/public` directory.

Example folder structure:

    \ my-extension
      - config.json
      - main.js
      \ public
        - style.css
      \ views
        - index.ejs

When handling routes, a few properties on the `req` object are overridden or added:

- `req.url`: For ease of routing, `req.url` is overridden to be relative to the extension's url.
- `req.absoluteUrl`: The original value of `req.url`, relative to the parent app's root.
- `req.rootUrl`: The root URL of the extension.
- `req.render()`: Automatically embeds the rendered content into the proper editor layout.

`absoluteUrl` and `rootUrl` are also available on the `viewLocals` object within a view. You can use this to reference static assets along with the `stylesheet()` and `script()` functions from [ejs-locals](https://github.com/RandomEtc/ejs-locals#scriptsrctype):

    <% stylesheet( viewLocals.rootUrl + '/style.css'); %>

### Front-end utilties

The Asteroid Editor uses [Twitter Bootstrap](http://twitter.github.io/bootstrap/) v2.3.1 for styling. You can use this framework in your own extensions.

The Asteroid Editor also provides a few JavaScript libraries by default:

- [jQuery](http://jquery.com/) v1.9.1 from CDN
- [Bootstrap](http://twitter.github.io/bootstrap/) v2.3.1
- [jQuery UI](http://jqueryui.com/) v1.8.24 - no theme included
- [Dynatree](https://code.google.com/p/dynatree/) v1.2.4 (used for the navigation sidebar)

You may import your own libraries and frameworks as needed:

    <% stylesheet( viewLocals.rootUrl + '/lib/backbone.js'); %>

The Asteroid Editor also provides a few global variables and functions on the JavaScript `window` object, for interacting with the editor's global state and UI:

- `PROJECT`: The name of the current project. Commonly used for constructing URLs.
- `EDITOR_SIDEBAR_NAVIGATION`: A JSON array of objects to construct the navigation sidebar. Usually not needed for extensions.
- `CURRENT_OBJECT_DIR`: The relative path of the current object, normalized to use `/` as a seperator. Undefined if no object is currently selected.
- `refreshProjectNavigationMenus()`: Update the navigation sidebar using AJAX. Call this after creating, deleting, or renaming objects, as well as if you change their dependencies or type.